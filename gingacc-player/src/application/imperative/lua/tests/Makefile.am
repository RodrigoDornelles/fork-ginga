# Makefile.am -- Template for generating Makefile via Automake.
#
# Copyright (C) 2006-2012 PUC-Rio/Laboratorio TeleMidia
#
# This program is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the Free
# Software Foundation; either version 2 of the License, or (at your option)
# any later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
# for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program; if not, write to the Free Software Foundation, Inc., 51
# Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.


AM_LDFLAGS= -static
AM_CPPFLAGS= -I..
LDADD= ../libnclua.la

check_PROGRAMS= test-nclua-status-to-string

TESTS=                          \
  $(check_PROGRAMS)             \
  test-event-register.xncl      \
  test-event-unregister.xncl    \
  test-event-register-key.xncl  \
  test-event-register-ncl.xncl  \
  test-event-register-user.xncl \
  test-event-post.xncl          \
  test-event-post-key.xncl      \
  test-event-post-ncl.xncl      \
  test-event-post-user.xncl     \
  test-event-uptime-0.xncl      \
  test-event-uptime-1.xncl      \
  test-event-timer-0.xncl       \
  test-event-timer-1.xncl

# TESTS=                        \
#   test-bad-lua-0.ncl          \
#   test-bad-lua-1.ncl

XFAIL_TESTS=
TESTS_ENVIRONMENT= $(srcdir)/run.sh

EXTRA_DIST=    \
  connbase.ncl \
  directfbrc   \
  exit.lua     \
  gdbinit      \
  tests.h      \
  tests.lua

# Generate the NCL wrappers.
SUFFIXES=.lua .xncl
.lua.xncl:
	@xncl="$*.xncl"; TESTNAME="$*"; \
	echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>" >$$xncl; \
	echo "<!-- Generated by Makefile.  DO NOT EDIT.  -->" >>$$xncl; \
	echo "<ncl id=\"$$TESTNAME\">" >>$$xncl; \
	echo "<head></head>" >>$$xncl; \
	echo "<body>" >>$$xncl; \
	echo "  <port id=\"start\" component=\"lua\"/>" >>$$xncl; \
	echo "  <media id=\"lua\" src=\"$$TESTNAME.lua\"/>" >>$$xncl; \
	echo "</body>" >>$$xncl; \
	echo "</ncl>" >>$$xncl;

clean-local:
	@for target in $(TESTS); do \
	  case $$target in \
	  *.xncl) rm -f $$target ;; \
	  *)      continue       ;; \
	  esac; \
	done

MAINTAINERCLEANFILES= Makefile.in
